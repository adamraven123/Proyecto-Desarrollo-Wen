{% extends "base.html" %} {% load bootstrap4 %} {% load static %} 
{% block css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
{% endblock css%}

{% block content %}
<div class = "container">
	<div class="row">
		<div class="col-lg-10 col-offset-4">
			<div class="card">
				<h5 class="card-header">{{tabla}}</h5>
				<div class="card-body">
					<div class="row">
						<div class="col">
					<h5 class="card-title">Stock de Materiales en sistema.</h5>
						</div>
						<div class="col">
					<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
			  		Ingresar Stock</button>
						</div>
					</div>
					<!-- Button trigger modal -->
					<p class="card-text"></p>
					<table class="table table-bordered">
					    <thead>
					        <tr>
					            <th>Nombre</th>
					            <th>Codigo</th>
					            <th>Tipo</th>
					            <th>Stock</th>
					        </tr>
					    </thead>
					    <tbody>
					        {% for material in materiales %}
					        <tr>
					            <td>{{ material.nombre }}</td>
					            <td>{{ material.pk }}</td>
					            <td>{{ material.tipo }}</td>
					            <td id="cant_{{material.pk}}">{{ material.total }}</td>
					        </tr>
					        {% endfor %}
					    </tbody>
					</table>
					<a type="submit" value="Enviar" id="hola" class="btn btn-primary text-white">Enviar</a>	
				</div>
			</div>
			
		</div>
	</div>	
</div>
<div class="container">
	<div class="row">
		<div class="col">
			<!-- Modal -->
			<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="exampleModalLabel">{{titulo}}</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			      	<form action="" method="POST" enctype="multipart/form-data"> {% csrf_token %}
						<div class="form-group row">
						<label class="col-md-3 col-form-label" for="id_material">Material</label>
						<div class="col-md-9">
							<select name="material" class="form-control" id="id_material" title="" required="">
							{% for material in materiales %}
							<option value="{{material.pk}}">{{material.nombre}} ({{material.total}})</option>
							{% endfor %}
							</select>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-md-3 col-form-label" for="id_cantidad">Cantidad:</label>
						<div class="col-md-9">
	  						<input type="number" class="form-control" name="cantidad" id="id_cantidad" required="">
	  					</div>
					</div>
					</form>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<a type="submit" value="Enviar" id="enviar" class="btn btn-primary text-white">Enviar</a>
			      </div>
			    </div>
			  </div>
			</div>
		</div>
	</div>
</div>
{% endblock content %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script>
	$(document).ready(function () {
		$(".select2").select2();
		$("#tc_list").addClass("active");
		
		$('.datepicker').datepicker({ format: 'dd/mm/yyyy' });
		
	});
</script>
<script>
	  $(document).ready(function(){
        $("#enviar").click(function(){
            var material = $('#id_material').val();
            var cantidad = $('#id_cantidad').val();
            var data = {
                csrfmiddlewaretoken: "{{csrf_token}}",
                material: material,
                cantidad: cantidad,
            }

            $.ajax({
                type: "POST",
                url: "{% url 'add_stock' %}",
                data: data,
                success: function(response){
                    swal("Exito!","Todo bien por aca.","success");
                    $("#enviar").html(response.mensaje);
                    $(response.select).html(response.cant)
            		console.log(response.select)
                },
                error: function(){
                    swal("Error!","Salio todo mal.","warning");
                },

            });
            console.log(data);
        });
    });
</script>
{% endblock javascript %}